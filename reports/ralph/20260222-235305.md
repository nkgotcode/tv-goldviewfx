# Ralph Loop Run 20260222-235305

## Goal

- Enforce stronger automated coverage gates for institutional readiness and harden ingestion worker coordination with DB-backed lease semantics.

## Changes

- Added backend critical coverage gate tooling:
  - `backend/scripts/check_critical_coverage.mjs`
  - `backend/scripts/critical_coverage_thresholds.json`
  - `backend/package.json` scripts: `test:coverage:critical`, `coverage:critical:check`, `test:coverage:gate`
- Added RL-service critical coverage gate tooling:
  - `backend/rl-service/scripts/check_critical_coverage.py`
  - `backend/rl-service/scripts/critical_coverage_thresholds.json`
- Updated CI gate workflow:
  - `.github/workflows/tests.yml` now runs backend and RL critical coverage gates.
- Raised frontend coverage gate and expanded coverage input:
  - `frontend/vitest.config.ts` include pattern now covers `.ts` + `.tsx` tests; thresholds raised.
  - Added `frontend/tests/api_service.test.ts` to cover API service contract paths.
- Added non-BingX ingestion lease semantics using `startIngestionRunIfIdle`:
  - `backend/src/services/tradingview_sync.ts`
  - `backend/src/services/telegram_ingest.ts`
  - `backend/src/services/news_ingest.ts`
  - `backend/src/services/ocr.ts`

## Validation

- Backend critical coverage gate:
  - `cd backend && bun run test:coverage:gate`
  - Result: pass.
- RL-service critical coverage gate:
  - `cd backend/rl-service && uv run pytest ... --cov=src --cov-branch --cov-report=xml:coverage-critical.xml --cov-report=term-missing`
  - `cd backend/rl-service && uv run python scripts/check_critical_coverage.py coverage-critical.xml scripts/critical_coverage_thresholds.json`
  - Result: pass.
- Frontend raised threshold gate:
  - `cd frontend && bun run test:coverage`
  - Result: pass.

## Risks / Follow-ups

- Backend critical coverage gates are file-scoped and intentionally transitional; full-repo 85/75 institutional thresholds remain future work.
- DB-gated integration suites still skip when DB connectivity is unavailable.

## Next Item

- Add deterministic replay post-condition assertions for data-gap healing with integration coverage.
